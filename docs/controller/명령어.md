# @jiny/admin 명령어 문서

## 📌 개요

@jiny/admin 패키지는 관리자 패널 구축을 위한 5가지 강력한 Artisan 명령어를 제공합니다. 이 명령어들은 CRUD 생성, 라우트 관리, 보안 관리 등 다양한 작업을 자동화합니다.

## 📋 명령어 목록

| 명령어 | 용도 | 주요 기능 |
|--------|------|-----------|
| `admin:make` | CRUD 모듈 생성 | 컨트롤러, 뷰, 모델, 마이그레이션 자동 생성 |
| `admin:remove` | CRUD 모듈 제거 | 생성된 모든 파일 및 데이터베이스 정리 |
| `admin:route-add` | 라우트 추가/복구 | 누락된 라우트 재등록 |
| `admin:password-reset` | 비밀번호 시도 초기화 | 차단된 계정 해제 |
| `admin:password-unblock` | 비밀번호 차단 해제 | 특정 계정 차단 해제 |

---

## 🛠️ admin:make - CRUD 모듈 생성

완전한 CRUD 관리자 패널 기능을 자동으로 생성하는 핵심 명령어입니다.

### 명령어 문법

```bash
php artisan admin:make {module} {feature} [options]
```

### 매개변수

| 매개변수 | 필수 | 설명 | 예시 |
|---------|------|------|------|
| `module` | ✅ | 모듈 이름 | `Shop`, `Blog`, `CRM` |
| `feature` | ✅ | 기능 이름 | `Product`, `Category`, `Customer` |

### 옵션

| 옵션 | 설명 | 예시 |
|------|------|------|
| `--with-seeder` | 샘플 데이터가 포함된 시더 생성 | `--with-seeder` |
| `--fields` | 추가 필드 정의 (쉼표로 구분) | `--fields="name:string,price:decimal"` |
| `--no-migration` | 마이그레이션 생성 및 실행 건너뛰기 | `--no-migration` |

### 사용 예시

```bash
# 기본 사용법
php artisan admin:make shop product

# 시더 포함
php artisan admin:make blog article --with-seeder

# 커스텀 필드 정의
php artisan admin:make crm customer --fields="company:string,phone:string,email:string"

# 마이그레이션 없이 생성 (기존 테이블 사용)
php artisan admin:make report sales --no-migration
```

### 생성되는 파일 구조

```
jiny/{module}/
├── App/
│   ├── Http/
│   │   └── Controllers/
│   │       └── Admin/
│   │           └── Admin{Feature}/
│   │               ├── Admin{Feature}.php           # 메인 목록 컨트롤러
│   │               ├── Admin{Feature}Create.php     # 생성 컨트롤러  
│   │               ├── Admin{Feature}Edit.php       # 수정 컨트롤러
│   │               ├── Admin{Feature}Show.php       # 상세보기 컨트롤러
│   │               ├── Admin{Feature}Delete.php     # 삭제 컨트롤러
│   │               └── Admin{Feature}.json          # 설정 파일
│   └── Models/
│       └── Admin{Feature}.php                       # Eloquent 모델
├── database/
│   ├── migrations/
│   │   └── {timestamp}_create_admin_{features}_table.php
│   └── factories/
│       └── Admin{Feature}Factory.php                # 모델 팩토리
├── resources/
│   └── views/
│       └── admin/
│           └── admin_{feature}/
│               ├── table.blade.php                  # 테이블 뷰
│               ├── create.blade.php                 # 생성 폼
│               ├── edit.blade.php                   # 수정 폼
│               ├── show.blade.php                   # 상세 뷰
│               └── search.blade.php                 # 검색 폼
└── routes/
    └── admin.php                                    # 라우트 정의 (자동 추가)
```

### JSON 설정 파일 구조

`Admin{Feature}.json` 파일이 자동으로 생성되며, 다음과 같은 구조를 가집니다:

```json
{
    "model": "Admin{Feature}",
    "table": {
        "name": "admin_{features}"
    },
    "route": {
        "name": "admin.{feature}",
        "prefix": "admin/{feature}"
    },
    "template": {
        "index": "template.index",
        "create": "template.create",
        "edit": "template.edit",
        "show": "template.show"
    },
    "index": {
        "table": {
            "columns": {
                "id": { "label": "ID", "sortable": true },
                "title": { "label": "제목", "sortable": true },
                "enable": { "label": "활성화", "sortable": false },
                "created_at": { "label": "생성일", "sortable": true }
            }
        },
        "pagination": {
            "perPage": 20,
            "perPageOptions": [10, 20, 50, 100]
        }
    }
}
```

---

## 🗑️ admin:remove - CRUD 모듈 제거

`admin:make`로 생성된 모든 파일과 데이터를 안전하게 제거합니다.

### 명령어 문법

```bash
php artisan admin:remove {module} {feature} [options]
```

### 매개변수

| 매개변수 | 필수 | 설명 |
|---------|------|------|
| `module` | ✅ | 제거할 모듈 이름 |
| `feature` | ✅ | 제거할 기능 이름 |

### 옵션

| 옵션 | 설명 |
|------|------|
| `--force` | 확인 없이 즉시 제거 |

### 사용 예시

```bash
# 확인 후 제거
php artisan admin:remove shop product

# 강제 제거 (확인 없음)
php artisan admin:remove blog article --force
```

### 제거 프로세스

1. **파일 제거**
   - 컨트롤러 (6개 파일)
   - 모델
   - 뷰 템플릿
   - 마이그레이션 파일

2. **데이터베이스 정리**
   - 테이블 삭제 (확인 필요)
   - 마이그레이션 히스토리 제거

3. **라우트 제거**
   - admin.php에서 관련 라우트 제거

4. **디렉토리 정리**
   - 빈 디렉토리 자동 삭제

---

## 🔗 admin:route-add - 라우트 추가/복구

기존 컨트롤러에 대한 라우트가 누락되었거나 삭제된 경우 복구합니다.

### 명령어 문법

```bash
php artisan admin:route-add {module} {feature}
```

### 사용 예시

```bash
# 라우트 추가/복구
php artisan admin:route-add shop product

# 여러 모듈 라우트 복구
php artisan admin:route-add blog article
php artisan admin:route-add crm customer
```

### 주요 기능

- 컨트롤러 존재 여부 확인
- 라우트 중복 체크
- admin.php 파일 자동 생성 (필요시)
- 등록된 라우트 정보 표시

### 생성되는 라우트

```php
// admin.php에 추가되는 라우트
Route::middleware(['web'])->prefix('admin')->group(function () {
    Route::group(['prefix' => '{feature}'], function () {
        Route::get('/', Admin{Feature}::class)->name('admin.{feature}');
        Route::get('/create', Admin{Feature}Create::class)->name('admin.{feature}.create');
        Route::get('/{id}/edit', Admin{Feature}Edit::class)->name('admin.{feature}.edit');
        Route::get('/{id}', Admin{Feature}Show::class)->name('admin.{feature}.show');
        Route::delete('/{id}', Admin{Feature}Delete::class)->name('admin.{feature}.delete');
    });
});
```

---

## 🔓 admin:password-reset - 비밀번호 시도 초기화

비밀번호 실패로 차단된 사용자의 시도 횟수를 초기화합니다.

### 명령어 문법

```bash
php artisan admin:password-reset [email] [options]
```

### 매개변수

| 매개변수 | 필수 | 설명 |
|---------|------|------|
| `email` | ❌ | 초기화할 이메일 주소 |

### 옵션

| 옵션 | 설명 | 예시 |
|------|------|------|
| `--ip` | 특정 IP의 모든 차단 해제 | `--ip=192.168.1.1` |
| `--days` | X일 이전의 차단 해제 (기본: 1일) | `--days=7` |
| `--all` | 모든 차단 해제 | `--all` |

### 사용 예시

```bash
# 특정 이메일 초기화
php artisan admin:password-reset admin@example.com

# 특정 IP의 모든 차단 해제
php artisan admin:password-reset --ip=192.168.1.100

# 7일 이전의 모든 차단 해제
php artisan admin:password-reset --days=7

# 모든 차단 해제 (주의!)
php artisan admin:password-reset --all
```

### 작업 내용

- 차단 상태 해제
- 시도 횟수 초기화
- 초기화 로그 생성
- 시스템 감사 로그 기록

---

## 🔐 admin:password-unblock - 비밀번호 차단 해제

차단된 계정을 선택적으로 해제합니다.

### 명령어 문법

```bash
php artisan admin:password-unblock [email] [options]
```

### 매개변수

| 매개변수 | 필수 | 설명 |
|---------|------|------|
| `email` | ❌ | 차단 해제할 이메일 주소 |

### 옵션

| 옵션 | 설명 |
|------|------|
| `--ip` | 특정 IP 차단 해제 |
| `--all` | 모든 차단 해제 |
| `--show` | 차단된 목록만 표시 |

### 사용 예시

```bash
# 차단된 목록 확인
php artisan admin:password-unblock --show

# 특정 이메일 차단 해제
php artisan admin:password-unblock admin@example.com

# 특정 IP 차단 해제
php artisan admin:password-unblock --ip=192.168.1.100

# 인터랙티브 모드 (매개변수 없이 실행)
php artisan admin:password-unblock

# 모든 차단 해제
php artisan admin:password-unblock --all
```

### 인터랙티브 모드

매개변수 없이 실행하면 대화형 모드가 시작됩니다:

1. 차단된 계정 목록 표시
2. 해제할 항목 선택
3. 개별 또는 전체 해제 옵션 제공

---

## 💡 모범 사례

### 1. 개발 워크플로우

```bash
# 1. 마이그레이션 생성
php artisan make:migration create_products_table

# 2. 마이그레이션 실행
php artisan migrate

# 3. CRUD 생성
php artisan admin:make shop product --with-seeder

# 4. 라우트 확인
php artisan route:list | grep admin.product
```

### 2. 명명 규칙

- **모듈명**: PascalCase (예: `Shop`, `Blog`)
- **기능명**: 단수형 PascalCase (예: `Product`, `Article`)
- **테이블명**: 복수형 snake_case (예: `products`, `articles`)

### 3. 보안 관리

```bash
# 정기적인 차단 해제 (크론 작업)
0 0 * * * php artisan admin:password-reset --days=30

# 차단 현황 모니터링
php artisan admin:password-unblock --show
```

---

## 🐛 문제 해결

### 일반적인 문제와 해결법

#### 1. "Class not found" 오류

```bash
# Composer 오토로드 재생성
composer dump-autoload

# 캐시 정리
php artisan cache:clear
php artisan config:clear
```

#### 2. 라우트를 찾을 수 없음

```bash
# 라우트 캐시 재생성
php artisan route:clear
php artisan route:cache

# 라우트 복구
php artisan admin:route-add {module} {feature}
```

#### 3. 마이그레이션 충돌

```bash
# 마이그레이션 상태 확인
php artisan migrate:status

# 롤백 후 재실행
php artisan migrate:rollback
php artisan migrate
```

#### 4. 권한 문제

```bash
# 디렉토리 권한 설정
chmod -R 755 jiny/
chown -R www-data:www-data jiny/
```

---

## 📊 명령어 실행 로그

모든 명령어는 다음 위치에 로그를 기록합니다:

- **시스템 로그**: `storage/logs/laravel.log`
- **관리자 활동 로그**: `admin_user_logs` 테이블
- **비밀번호 로그**: `admin_password_logs` 테이블

### 로그 확인 방법

```bash
# 최근 로그 확인
tail -f storage/logs/laravel.log

# 특정 명령어 로그 필터링
grep "admin:make" storage/logs/laravel.log

# 데이터베이스 로그 확인
php artisan tinker
>>> \DB::table('admin_user_logs')->where('action', 'like', '%command%')->get();
```

---

## 🔄 버전별 변경사항

### v1.0.0 (현재)

- ✅ `admin:make` - 기본 CRUD 생성
- ✅ `admin:remove` - 모듈 제거
- ✅ `admin:route-add` - 라우트 복구
- ✅ `admin:password-reset` - 비밀번호 초기화
- ✅ `admin:password-unblock` - 차단 해제

### 향후 계획

- 📝 `admin:backup` - 설정 백업/복원
- 📝 `admin:export` - 데이터 내보내기
- 📝 `admin:import` - 데이터 가져오기
- 📝 `admin:scaffold` - 고급 스캐폴딩

---

## 📚 참고 자료

- [Laravel Artisan Documentation](https://laravel.com/docs/artisan)
- [@jiny/admin GitHub Repository](https://github.com/jinyphp/admin)
- [Livewire 3 Documentation](https://livewire.laravel.com)

---

*이 문서는 @jiny/admin v1.0.0 기준으로 작성되었습니다.*